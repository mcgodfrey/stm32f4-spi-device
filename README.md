# stm32f4-spi-device

Example code for setting the SPI DMA peripheral in device mode on an STM32F4xx microcontroller running FreeRTOS.

Detailed overview of the code here: https://dangerfromdeer.com/?p=1174

## Overview

This project is a complete example project including:
  - STM32CubeMX project file, firmware, makefile etc for building the firmware
  - python script for running on raspberry pi to act as the SPI controller to test the code

The example firmware implements a very simple SPI device which can save and return a string over SPI.
It runs 2 FreeRTOS threads, one is the "main task" (which just blinks an LED), and the other is the "comms task" which handles the SPI communication.

The comms task runs a loop which sets up the SPI DMA transfer and then sleeps until the controller sends a message.
The task is woken by the SPI complete interrupt, where is processes the message, sets up the next transfer and then goes back to sleep.

The python controller test just test the basic functionality by reading and writing a string to/from the device.

## Note

Due to the large size of the library code generated by cubeMX (>100MB), the /Drivers/CMSIS and /Drivers/STM32F4xx_HAL_Driver directories have been excluded from this repo.
They will be automatically generated when the CubeMX project is run to generate the code.
Note: this means that the project as-is will not compile without first re-generating the code in CubeMX.